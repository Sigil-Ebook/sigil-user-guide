<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en" xml:lang="en">
<head>
  <title>Find &amp; Replace</title>
  <link href="../Styles/styles.css" type="text/css" rel="stylesheet"/>
</head>

<body>
  <h2 id="find_and_replace">Find &amp; Replace</h2>

  <p class="h2subheading">— Searching in Code View —</p>

  <p>Finding text and updating it is one of the most common tasks in Sigil – to look for words, to remove or replace unwanted text, or to change the formatting. In fact, if you ever need to make lots of changes to your text, you will almost certainly want to use Find &amp; Replace (and its related <a href="saved_searches.xhtml">Saved Searches</a> feature), since it allows you to quickly make a large number of edits across all your files.</p>

  <div class="tip">
    <p class="tiptext">See the <a href="tutorial_regex_reference.xhtml">Regex</a> tutorial for information about advanced searching.</p>
  </div>

  <p>To open the Find &amp; Replace dialog, select the menu item <span class="menuitem">Search=&gt;Find &amp; Replace</span>, its keyboard shortcut, or toolbar button <img alt="Find Replace icon." src="../Images/find-replace-button.png"/>.</p>

  <div class="image">
    <img alt="Find Replace Dialog window." src="../Images/find-replace-options.png"/>
  </div>

  <p>When open, the Find &amp; Replace dialog is always positioned at the bottom of the editing window for easy access. Advanced regular expression options have their own menu.</p>
  
  <div class="tip">
    <p class="tiptext">Keyboard shortcuts exist for all Find &amp; Replace operations, such as <span class="shortcut">Ctrl+F</span> to find and <span class="shortcut">Ctrl+G</span> to find again (on Mac use <span class="shortcut">Cmd</span> instead of <span class="shortcut">Ctrl</span>). See the <span class="menuitem">Search</span> menu for a list of shortcuts.</p>
  </div>

  <h3 class="sigil_not_in_toc" id="find_actions">Action Buttons</h3>

  <p>The buttons on the right are used to run your search commands: Find , Restart, Replace, Replace/Find, Replace All, and Count All.</p>

  <h4 class="sigil_not_in_toc">Find ( <img width="24" alt="find button" src="../Images/find.svg"/> )</h4>

  <p>Finds the next occurrence of your search term and highlights it in Code View.</p>
  
  <p>To find text:</p>

  	<ul>
		<li>Enter the text you wish to find in the Find box.</li>

		<li>Click <span class="buttonbox"><img width="14" alt="find button" src="../Images/find.svg"/></span> to search for and highlight the next match in the Code View window.</li>
	</ul>

  <p>Any text in the Replace box is ignored if you are just doing a Find.</p>

  <div class="tip">
    <p class="tiptext">If you select text in Code View, then use <span class="shortcut">Ctrl+F</span> (on Mac: <span class="shortcut">Cmd+F</span>) to open the Find &amp; Replace window, Sigil will automatically place your selected text in the Find box.</p>
    
    <p class="tiptext">After you run a search, the text you entered in either the Find or Replace box is automatically saved to a history list that is available for later use. Click the down-arrow to the right of the Find or Replace text box to see a dropdown menu of your search history list.</p>
    
    <p class="tiptext">Status messages appear in the lower right corner.</p>
  </div>

  <h4 class="sigil_not_in_toc">Restart ( <img width="24" alt="restart button" src="../Images/restart.svg"/> )</h4>

  <p>Restarts a multiple file Find and Replace Search back at the top of the first file.  The next Find will begin from there.</p>
  

  <h4 class="sigil_not_in_toc">Replace ( <img width="24" alt="replace button" src="../Images/replace.svg"/> )</h4>

  <p>Replaces one occurrence of the text matched by Find.</p>

  <p>To replace text:</p>

  <ul>
    <li>Enter the text to find in the Find box.</li>

    <li>Enter the text you want to replace it with in the Replace box.</li>

    <li>Click <span class="buttonbox"><img width="14" alt="find button" src="../Images/find.svg"/></span> to search for and highlight the next match.</li>

    <li>Click <span class="buttonbox"><img width="14" alt="replace button" src="../Images/replace.svg"/></span> to do the replacement.</li>
  </ul>

  <div class="tip">
    <p class="tiptext">To undo changes, use <span class="shortcut">Ctrl+Z</span> (on Mac: <span class="shortcut">Cmd+Z</span>) or the Undo button <img alt="Showing Undo icon." src="../Images/edit-undo.png"/>, or right-click in the Code View window and select <span class="menuitem">Undo</span> to change the text back. But if you are replacing across multiple files and your next match is in a different file, you need to switch back to the file containing the replaced text before selecting undo.</p>
  </div>

  <h4 class="sigil_not_in_toc">Replace/Find ( <img width="24" alt="replace-find button" src="../Images/replace-find.svg"/> )</h4>

  <p>Replaces one occurrence of the next match then automatically finds and highlights the subsequent match.</p>
  
  <p>The first time you do a Replace/Find the first match will be highlighted but not replaced. Subsequent use of Replace/Find will replace the highlighted matched text and then automatically find the next match.</p>

   <p>To replace text then automatically find the next match:</p>

	  <ul>
		<li>Enter the text to find in the Find box.</li>

		<li>Enter the text you want to replace it with in the Replace box.</li>
	
		<li>Click <span class="buttonbox"><img width="14" alt="replace-find button" src="../Images/replace-find.svg"/></span> to search for and highlight the first match.</li>

		<li>Click <span class="buttonbox"><img width="14" alt="replace-find button" src="../Images/replace-find.svg"/></span> to replace the match, then automatically find and highlight the next match.</li>
	  </ul>
	  

  <div class="tip">
    <p class="tiptext">You can safely use Replace/Find instead of Find if no text is selected since it will act just like Find until a match is highlighted.</p>
  </div>

  <h4 class="sigil_not_in_toc">Replace All ( <img width="24" alt="replace all button" src="../Images/replace-all.svg"/> )</h4>

  <p>Replaces all text matching your search term with your replace term, according to your settings. This is done all at once automatically.</p>
  
    <div class="tip">
    <p class="tiptext">You cannot undo a Replace All – save first! Or create a <a href="checkpoints.xhtml">Checkpoint</a></p>
  </div>

	 <p>To replace all:</p>

	  <ul>
		<li>Enter the text to find in the Find box.</li>

		<li>Enter the text you want to replace it with in the Replace box.</li>

		<li>Click <span class="buttonbox"><img width="14" alt="replace all button" src="../Images/replace-all.svg"/></span> to replace all matches in one go.</li>
	  </ul>

  <p>Replace All always replaces from the start of a file.</p>

  <div class="tip">
    <p class="tiptext">To avoid unpleasant surprises, test your find and replace string using Count All to see if the number of matches is in the expected range. You can also tests with a simple Replace a few times.</p>

<p class="tiptext"> Starting with Sigil-1.9.10 you can use the Dry-Run Replace All tool to safely see all of the potential replacements in one table before actually performing any replacements.</p>

    <p class="tiptext">Save your book or create a Checkpoint before a Replace All and check it for issues afterward.  </p>

    <p class="tiptext">Before executing a Replace All, check if your mode is set for Current File or All HTML Files.</p>
  </div>

  <h4 class="sigil_not_in_toc" id="count_all">Count All ( <img width="24" alt="count-all button" src="../Images/count-all.svg"/> )</h4>
  
  <p>Counts the number of times the search term you entered in the Find text box occurs in the selected files, then displays the results in the lower right corner of the Find &amp; Replace window. Count All uses all Mode settings including Up/Down, plus the Wrap option.</p>

	 <p>To count all matches in the selected files:</p>

	  <ul>
		<li>Enter the text to find in the Find box.</li>

		<li>Click <span class="buttonbox"><img width="14" alt="count-all button" src="../Images/count-all.svg"/></span>.</li>
	  </ul>

  <div class="tip">
    <p class="tiptext">It’s a good idea to use Count All before doing a Replace All to confirm that the number of replacements will be what you expect. You should also run it after a Replace All in case the particular search and replace created new matches. Alternatively use the new Dry Run Replace All tool (see next).</p>
  </div>

  <h4 class="sigil_not_in_toc">Dry Run Replace All ( SHIFT + <img width="24" alt="Shift + count-all button" src="../Images/count-all.svg"/> ) (New in Sigil 1.9.10)</h4>

  <p>Often when crafting regular expression for Find and Replace, it is difficult to know if your find string will properly detect the cases you want while excluding the cases you do not want.  This table shows the results of a trial dry-run of your current find and replace terms in context. No actual replacements/changes are ever made. The amount of context both "before" and "after" a match (in characters) can be controlled by the user. This tool can by launched by Shift clicking on the Count-All button.</p>

<div><img alt="Dry Run Replace All" src="../Images/dry-run-replace-dialog.png"/></div>

<p>Dry Run Replace All allows the user to safely experiment with their search terms to see which if any would be most effective.  Any row in the table can be double-clicked and the exact context for that particular match will be brought up in CodeView for the user to examine in more detail or to edit.  This way a user can verify that a find replace all sequence will do exactly what they expect it to do. If the user makes changes to the underlying text that will impact the table, the user can click on the "Refresh" button at any time to force the table to be rebuilt.</p>
  
	 <p>To create a Dry Run Replace All Table:</p>

	  <ul>
		<li>Enter the text to find in the Find box.</li>

		<li>Enter the text you want to replace it with in the Replace box.</li>

		<li>Click <span class="buttonbox">SHIFT + <img width="14" alt="count-all" src="../Images/count-all.svg"/></span>.</li>
	  </ul>


  <h4 class="sigil_not_in_toc">Filter Replacements ( SHIFT + <img width="24" alt="replace-all button" src="../Images/replace-all.svg"/> ) (New in Sigil 1.9.10)</h4>

  <p>This tool helps users use Find and Replace All more effectively. It lists all of the matches found in context and shows each replacement in that same context.  The amount of context both "before" and "after" a match (in characters) can be controlled by the user.</p>

<div><img alt="Replace-Delete-Unwanted" src="../Images/replace-delete-unwanted.png"/></div>

<p>If the user sees a match that is unwanted - i.e. they do not want that replacement to be made, they can select that match's row in the table and use the delete key or select delete on the pop-up menu to remove it.  When all unwanted matches have been found and deleted, the user can then use the "Apply Changes" button to have just the changes remaining in the table made.</p>

<p>Filter Replacements allows the user to more safely use Replace All by lowering the risk or undesirable replacements.</p>
  
	 <p>To create a Filter Replacements Table:</p>

	  <ul>
		<li>Enter the text to find in the Find box.</li>

		<li>Enter the text you want to replace it with in the Replace box.</li>

		<li>Click <span class="buttonbox">SHIFT + <img width="14" alt="replace-all" src="../Images/replace-all.svg"/></span>.</li>
	  </ul>


  <h3 class="sigil_not_in_toc" id="find_what">Search Modes</h3>
  
  <p>Sigil provides three dropdown menus containing different search modes to give you greater control over your search.</p>
  
  <h4 id="sigil_toc_id_29">What to Search For</h4>
  
  		<ul>
  			<li><p><span class="listheading">Normal:</span> Search for exactly what you type in the Find box except ignore case, e.g. “A” and “a” will be considered the same letter.</p></li>
  			
  	  		<li><p><span class="listheading">Case Sensitive:</span> Search for exactly what you type in the Find box, e.g. “A” and “a” will be considered different letters.</p></li>
  	  		
  			<li><p><span class="listheading">Regex:</span> Short for “Regular Expression”, Regex mode allows you to search for patterns instead of exact words or characters. Regex is very powerful and one of the main benefits of using Sigil to work with ebooks. For instance, you can search for “Page [0-9]+” which will find “Page ” followed by one or more numbers.</p>
  			
  			  <div class="tip">
				<p class="tiptext">See the <a href="tutorial_regex_reference.xhtml">Regular Expressions</a> chapter for more details about using regex.</p>
			  </div>
			</li>
  		</ul>

  <h4 class="sigil_not_in_toc">Where to Search</h4>
  
  	<ul>
  		<li><p><span class="listheading">Current File:</span> Search only in the file displayed in the Code View window. You can search all file types, including HTML, XHTML, CSS, OPF, NCX.</p>

  			<p>If your search reaches the end of the file and Wrap is turned on, it will automatically wrap around and search from the other end of the file. A small picture of an arrow will flash on the screen to indicate that the search wrapped around.</p>
  			
  			  <div class="tip">
    			<p class="tiptext">To temporarily run the search on the Current File only, hold the <span class="shortcut">Ctrl</span> key down (on Mac: <span class="shortcut">Cmd</span> key) while clicking on an action button. This is useful if you want to search a stylesheet while the mode is set on All HTML Files.</p>
  			</div>
		</li>

  		<li><p><span class="listheading">All HTML Files:</span> Search in every HTML/XHTML file – but do not search in other file types, such as CSS, OPF or NCX.</p>

  			<p>When a search reaches the end or beginning of a file, it will automatically move to the next or previous file (in the order listed in the Book Browser). If Wrap is turned on, it will loop around until all files have been searched.</p></li>

  		<li><p><span class="listheading">Selected HTML Files:</span> Search only the HTML files selected in the Book Browser.</p>

  			  <p>When a search reaches the end or beginning of a file, it will automatically move to the next or previous selected file (in the order listed in the Book Browser). If Wrap is turned on, it will loop around until all selected files have been searched.</p></li>
  		
        <li><p><span class="listheading">Tabbed HTML Files:</span> Search only the HTML files that are open as Tabs in the Tab Manager.</p>

  			  <p>When a search reaches the end or beginning of a file, it will automatically move to the next or previous selected file (in the order opened in the Tab Manager). If Wrap is turned on, it will loop around until all selected files have been searched.</p></li>

   		<li><p><span class="listheading">All CSS Files:</span> Search in every CSS file – but do not search in other file types, such as HTML, OPF or NCX.</p>

  			<p>When a search reaches the end or beginning of a file, it will automatically move to the next or previous file (in the order listed in the Book Browser). If Wrap is turned on, it will loop around until all files have been searched.</p></li>

  		<li><p><span class="listheading">Selected CSS Files:</span> Search only the CSS files selected in the Book Browser.</p>

  			  <p>When a search reaches the end or beginning of a file, it will automatically move to the next or previous selected file (in the order listed in the Book Browser). If Wrap is turned on, it will loop around until all selected files have been searched.</p></li>
  		
        <li><p><span class="listheading">Tabbed CSS Files:</span> Search only the CSS files that are open as Tabs in the Tab Manager.</p>

  			  <p>When a search reaches the end or beginning of a file, it will automatically move to the next or previous selected file (in the order opened in the Tab Manager). If Wrap is turned on, it will loop around until all selected files have been searched.</p></li>
 			
  		<li><p><span class="listheading">OPF File:</span> Search only the OPF file.</p>
  			  <p>Special care must be used when using Replace in the OPF file as it is effectively the heart of the epub and controls pretty much everything. The importance of Checkpoints or saving the file first can not be overstated.</p></li>

  		<li><p><span class="listheading">NCX File:</span> Search only the NCX file in EPUB2 and EPUB3 if one exists </p></li>

  		<li><p><span class="listheading">Marked Text:</span> This is a special option that is only shown when you mark text. To restrict your search to a portion of text, first select some text in Code View, then go to menu item <span class="menuitem">Search=&gt;Mark Selected Text</span> or use right-click context menu <span class="menuitem">Mark Selected Text</span>.</p>

		  <p>Text can be unmarked by using the menu item again without a selection. Text will also be unmarked if you use Undo, type any text, or change tabs. If you just use Replace or Replace All, the marked text will remain marked, but it will be revised according to your replacement.</p></li>


      <li><p><span class="listheading">Selected SVG files</span>: Search only in the set of SVG image files currently selected in the Book Browser.</p></li>

      <li><p><span class="listheading">Selected Javascript files</span>: Search only in the set of javascript files currently selected in the Book Browser.</p></li>

      <li><span class="listheading">Selected Misc XML files</span>: Search only in the set of XML files currently selected inside the Misc folder in the Book Browser. Currently this includes pure XML files with any of the following media types:
      <ul>
        <li>application/ttml+xml</li>
        <li>application/smil+xml</li>
        <li>application/smil</li>
        <li>application/pls+xml</li>
        <li>application/oebps-page-map+xml</li>
        <li>application/vnd.adobe-page-map+xml</li>
        <li>application/adobe-page-template+xml</li>
        <li>application/vnd.adobe-page-template+xml</li>
        <li>application/xml</li>
        <li>text/xml</li>
      </ul>
      </li>

	</ul>
 
  <h4 class="sigil_not_in_toc">Search Direction</h4>
  
  	<ul>
  		<li><p><span class="listheading">Up:</span> Search from your position in the document upwards and find the previous occurrence of your search.</p></li>
  		
  		<li><p><span class="listheading">Down:</span> Search from your position in the document downwards and find the next occurrence of your search.</p></li>
	</ul>
 
 
  <h3 class="sigil_not_in_toc">Search Options</h3>

  <p>The Options menu offers useful switches when using Regex mode, as well as a checkbox to control whether Wrap in the Current File is turned on or off.</p>
  
  <div class="image">
    <img alt="Find and Replace Dialog showing options." src="../Images/find-replace-options.png"/>
  </div>


  <p>Regular Expression Search Options include:</p>
  
	<ul>
		<li><p><span class="listheading">DotAll:</span> This regex option prepends (?s) to all regex searches and is used when you want .* to match any character, even across lines.</p></li>

		<li><p><span class="listheading">Minimal Match:</span> This regex option prepends (?U) to all regex searches and is used when you want a pattern to match the shortest occurrence instead of the longest match.</p></li>

		<li><p><span class="listheading">Auto-Tokenise:</span> When using <span class="shortcut">Ctrl-F</span> (on Mac: <span class="shortcut">Cmd-F</span>) on selected text to copy it into the Find box, this will convert spaces to \s and escape certain characters so they are suitable for regex.</p></li>

       <li><p><span class="listheading">Unicode Property</span>: Tells search that you want to treat all regex character placeholders with their unicode property equivalents. See Regex documentation for the flag: (*UCP)</p></li>

   </ul>

  <p>Other General Search Options</p>

   <ul>		
		<li><p><span class="listheading">Wrap:</span> When enabled in Current File mode, if your search reaches the end of the file, it will automatically wrap around to the beginning of the file to continue the search (or the reverse if searching Up). When disabled, searches will stop at the end of the file (or the beginning if searching Up).</p>

  			<p>When searching in a mode that uses multiple files, when your search reaches the last file (in the order listed in the Book Browser), you will need to use the <span class="buttonbox">Restart</span> button otherwise the search will stop. <b>Wrap</b> does not apply when searching multiple files.</p></li>

		<li><p><span class="listheading">Text:</span> When enabled in any mode, if searching XHTML files, it will match only text outside of &lt; XHTML tags &gt;. This option has no effect when not searching in XHTML files.</p>

           <p>This is can be useful when doing find and replace on words that can incidentally be valid XHTML attributes, attribute values, or tag names that you no want to replace.</p>
       </li>

	</ul>


  <h3 class="sigil_not_in_toc">Context Menu</h3>

  <p>If you right-click on the Find or Replace box, it will bring up a context menu with the following options:</p>

  <ul>
    <li><p><span class="listheading"><i>Saved Searches</i>:</span> At the top of the context menu will be a list of your Saved Searches (see <a href="saved_searches.xhtml">Saved Searches</a> chapter for more information). Selecting one will load it into the Find &amp; Replace window.</p></li>

    <li><p><span class="listheading">Save Search:</span> Save the current Find &amp; Replace search to Saved Searches.</p></li>

    <li><p><span class="listheading">Tokenise Selection:</span> Convert spaces to \s and escape certain characters.</p></li>

    <li><p><span class="listheading">Clear Find Replace History:</span> Clears out the all recent historyor previous Find and Replace values.</p></li>
  </ul>


  <h3 class="sigil_not_in_toc">Handling Special Characters in Find and Replace</h3>

  <p>As some characters are hard for many keyboards to produce easily, Find and Replace now supports using hex escape codes to allow the user to specificy a character by its 4 digit hexadecimal numeric code.</p>

  <p>The format is \x{hhhh} where each "h" represents the a single hexidecimal value - 0 to 9 and A to F.</p>

<p>For example: to replace all non-breaking space (nbsp) characters which has acharacter code 160 you could use: \x{00A0} to represent that character.</p>

</body>
</html>